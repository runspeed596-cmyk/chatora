<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h2>
            </div>

            <nav>
                <ul class="sidebar-nav">
                    <li><a href="dashboard.html">
                            <span>ğŸ“Š</span>
                            <span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
                        </a></li>
                    <li><a href="products.html" class="active">
                            <span>ğŸ“¦</span>
                            <span>Ù…Ø­ØµÙˆÙ„Ø§Øª</span>
                        </a></li>
                    <li><a href="categories.html">
                            <span>ğŸ“‚</span>
                            <span>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span>
                        </a></li>
                    <li><a href="colors.html">
                            <span>ğŸ¨</span>
                            <span>Ø±Ù†Ú¯â€ŒÙ‡Ø§</span>
                        </a></li>
                    <li><a href="sizes.html">
                            <span>ğŸ“</span>
                            <span>Ø³Ø§ÛŒØ²Ù‡Ø§</span>
                        </a></li>
                    <li><a href="#" onclick="logout(); return false;">
                            <span>ğŸšª</span>
                            <span>Ø®Ø±ÙˆØ¬</span>
                        </a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-bar">
                <h1>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h1>
                <div class="user-menu">
                    <span id="adminUsername">Ù…Ø¯ÛŒØ±</span>
                    <div class="user-avatar">A</div>
                </div>
            </div>

            <div class="content-card">
                <div class="content-header">
                    <h2>Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
                    <a href="product-form.html" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</a>
                </div>

                <!-- Search -->
                <div class="mb-3">
                    <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." class="form-group"
                        style="max-width: 400px;">
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Ø´Ù†Ø§Ø³Ù‡</th>
                            <th>Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ù‚ÛŒÙ…Øª</th>
                            <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
                            <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable">
                        <tr>
                            <td colspan="7" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td>
                        </tr>
                    </tbody>
                </table>

                <div class="pagination" id="pagination"></div>
            </div>
        </main>
    </div>

    <script src="js/admin.js"></script>
    <script>
        checkAuth();

        let currentPage = 0;
        const pageSize = 10;

        async function loadProducts(page = 0) {
            currentPage = page;
            const tbody = document.getElementById('productsTable');

            try {
                const response = await apiRequest(`/api/product?pageSize=${pageSize}&pageIndex=${page}`);

                if (response && response.data && response.data.length > 0) {
                    tbody.innerHTML = '';
                    response.data.forEach(product => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${product.id}</td>
                            <td>${product.title}</td>
                            <td>${formatPrice(product.price)}</td>
                            <td>${product.stockQuantity || 0}</td>
                            <td>${product.category?.title || '-'}</td>
                            <td>
                                <span style="color: ${product.isActive ? '#4facfe' : '#f5576c'}">
                                    ${product.isActive ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                                </span>
                            </td>
                            <td>
                                <div class="flex gap-1">
                                    <a href="product-form.html?id=${product.id}" class="btn btn-sm btn-secondary">ÙˆÛŒØ±Ø§ÛŒØ´</a>
                                    <button onclick="deleteProduct(${product.id})" class="btn btn-sm btn-danger">Ø­Ø°Ù</button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });

                    // Update pagination
                    if (response.totalCount) {
                        renderPagination(response.totalCount, pageSize, currentPage,
                            document.getElementById('pagination'), loadProducts);
                    }
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
                }
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</td></tr>';
                console.error('Error:', error);
            }
        }

        async function deleteProduct(id) {
            if (!confirmAction('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                return;
            }

            try {
                const response = await apiRequest(`/api/admin/product/${id}`, {
                    method: 'DELETE'
                });

                if (response && response.status === 'OK') {
                    showNotification('Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯', 'success');
                    loadProducts(currentPage);
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø­ØµÙˆÙ„', 'error');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø­ØµÙˆÙ„', 'error');
            }
        }

        // Search
        document.getElementById('searchInput').addEventListener('input', debounce((e) => {
            // Implement search logic here
            console.log('Searching for:', e.target.value);
        }, 500));

        // Initialize
        loadProducts();
    </script>
</body>

</html>