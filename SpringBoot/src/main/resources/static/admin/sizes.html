<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§ÛŒØ²Ù‡Ø§ - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h2>
            </div>
            <nav>
                <ul class="sidebar-nav">
                    <li><a href="dashboard.html"><span>ğŸ“Š</span><span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span></a></li>
                    <li><a href="products.html"><span>ğŸ“¦</span><span>Ù…Ø­ØµÙˆÙ„Ø§Øª</span></a></li>
                    <li><a href="categories.html"><span>ğŸ“‚</span><span>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span></a></li>
                    <li><a href="colors.html"><span>ğŸ¨</span><span>Ø±Ù†Ú¯â€ŒÙ‡Ø§</span></a></li>
                    <li><a href="sizes.html" class="active"><span>ğŸ“</span><span>Ø³Ø§ÛŒØ²Ù‡Ø§</span></a></li>
                    <li><a href="#" onclick="logout(); return false;"><span>ğŸšª</span><span>Ø®Ø±ÙˆØ¬</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <h1>Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§ÛŒØ²Ù‡Ø§</h1>
                <div class="user-menu">
                    <span id="adminUsername">Ù…Ø¯ÛŒØ±</span>
                    <div class="user-avatar">A</div>
                </div>
            </div>

            <div class="content-card">
                <div class="content-header">
                    <h2>Ù„ÛŒØ³Øª Ø³Ø§ÛŒØ²Ù‡Ø§</h2>
                    <button onclick="openAddModal()" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§ÛŒØ² Ø¬Ø¯ÛŒØ¯</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Ø´Ù†Ø§Ø³Ù‡</th>
                            <th>Ø³Ø§ÛŒØ²</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="sizesTable">
                        <tr>
                            <td colspan="3" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add/Edit Modal -->
    <div id="sizeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§ÛŒØ²</h2>
                <button class="close-modal" onclick="closeModal('sizeModal')">Ã—</button>
            </div>
            <form id="sizeForm">
                <input type="hidden" id="sizeId">
                <div class="form-group">
                    <label for="title">Ø³Ø§ÛŒØ² (Ø¹Ø¯Ø¯) *</label>
                    <input type="number" id="title" required min="0">
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary" id="submitBtn">Ø°Ø®ÛŒØ±Ù‡</button>
                    <button type="button" onclick="closeModal('sizeModal')" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        checkAuth();

        async function loadSizes() {
            const tableBody = document.getElementById('sizesTable');
            try {
                const response = await apiRequest('/api/size');

                if (!response || !response.data) {
                    tableBody.innerHTML = '<tr><td colspan="3" class="text-center">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</td></tr>';
                    return;
                }

                if (response.data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="3" class="text-center">Ù‡ÛŒÚ† Ø³Ø§ÛŒØ²ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
                    return;
                }

                tableBody.innerHTML = '';
                response.data.forEach(size => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${size.id}</td>
                        <td>${size.title}</td>
                        <td>
                            <button onclick="editSize(${size.id})" class="btn btn-sm btn-secondary">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button onclick="deleteSize(${size.id})" class="btn btn-sm btn-danger">Ø­Ø°Ù</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading sizes:', error);
                tableBody.innerHTML = '<tr><td colspan="3" class="text-center">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§ÛŒØ²Ù‡Ø§</td></tr>';
            }
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§ÛŒØ²';
            document.getElementById('sizeForm').reset();
            document.getElementById('sizeId').value = '';
            openModal('sizeModal');
        }

        async function editSize(id) {
            try {
                const response = await apiRequest(`/api/size/${id}`);
                if (response && response.data && response.data.length > 0) {
                    const size = response.data[0];
                    document.getElementById('modalTitle').textContent = 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø³Ø§ÛŒØ²';
                    document.getElementById('sizeId').value = size.id;
                    document.getElementById('title').value = size.title;
                    openModal('sizeModal');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§ÛŒØ²', 'error');
            }
        }

        async function deleteSize(id) {
            if (!confirmAction('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø³Ø§ÛŒØ² Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;

            try {
                const response = await apiRequest(`/api/admin/size/${id}`, { method: 'DELETE' });
                if (response && response.status === 'OK') {
                    showNotification('Ø³Ø§ÛŒØ² Ø­Ø°Ù Ø´Ø¯', 'success');
                    loadSizes();
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù', 'error');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù', 'error');
            }
        }

        document.getElementById('sizeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            setLoading(submitBtn, true);

            const id = document.getElementById('sizeId').value;
            const data = {
                title: parseInt(document.getElementById('title').value)
            };

            try {
                let response;
                if (id) {
                    response = await apiRequest(`/api/admin/size/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify(data)
                    });
                } else {
                    response = await apiRequest('/api/admin/size', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                }

                if (response && (response.status === 'OK' || response.status === 'CREATED')) {
                    showNotification('Ø³Ø§ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                    closeModal('sizeModal');
                    loadSizes();
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡', 'error');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡', 'error');
            } finally {
                setLoading(submitBtn, false);
            }
        });

        loadSizes();
    </script>
</body>

</html>