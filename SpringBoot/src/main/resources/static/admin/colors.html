<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù†Ú¯â€ŒÙ‡Ø§ - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h2>
            </div>
            <nav>
                <ul class="sidebar-nav">
                    <li><a href="dashboard.html"><span>ğŸ“Š</span><span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span></a></li>
                    <li><a href="products.html"><span>ğŸ“¦</span><span>Ù…Ø­ØµÙˆÙ„Ø§Øª</span></a></li>
                    <li><a href="categories.html"><span>ğŸ“‚</span><span>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span></a></li>
                    <li><a href="colors.html" class="active"><span>ğŸ¨</span><span>Ø±Ù†Ú¯â€ŒÙ‡Ø§</span></a></li>
                    <li><a href="sizes.html"><span>ğŸ“</span><span>Ø³Ø§ÛŒØ²Ù‡Ø§</span></a></li>
                    <li><a href="#" onclick="logout(); return false;"><span>ğŸšª</span><span>Ø®Ø±ÙˆØ¬</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <h1>Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù†Ú¯â€ŒÙ‡Ø§</h1>
                <div class="user-menu">
                    <span id="adminUsername">Ù…Ø¯ÛŒØ±</span>
                    <div class="user-avatar">A</div>
                </div>
            </div>

            <div class="content-card">
                <div class="content-header">
                    <h2>Ù„ÛŒØ³Øª Ø±Ù†Ú¯â€ŒÙ‡Ø§</h2>
                    <button onclick="openAddModal()" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ø±Ù†Ú¯ Ø¬Ø¯ÛŒØ¯</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Ø´Ù†Ø§Ø³Ù‡</th>
                            <th>Ù†Ø§Ù… Ø±Ù†Ú¯</th>
                            <th>Ú©Ø¯ Ø±Ù†Ú¯</th>
                            <th>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="colorsTable">
                        <tr>
                            <td colspan="5" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add/Edit Modal -->
    <div id="colorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ø§ÙØ²ÙˆØ¯Ù† Ø±Ù†Ú¯</h2>
                <button class="close-modal" onclick="closeModal('colorModal')">Ã—</button>
            </div>
            <form id="colorForm">
                <input type="hidden" id="colorId">
                <div class="form-group">
                    <label for="title">Ù†Ø§Ù… Ø±Ù†Ú¯ *</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="hexValue">Ú©Ø¯ Ø±Ù†Ú¯ (HEX) *</label>
                    <div class="flex gap-2">
                        <input type="text" id="hexValue" required placeholder="#000000" pattern="#[0-9A-Fa-f]{6}">
                        <input type="color" id="colorPicker" onchange="updateHexValue(this.value)">
                    </div>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary" id="submitBtn">Ø°Ø®ÛŒØ±Ù‡</button>
                    <button type="button" onclick="closeModal('colorModal')" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        checkAuth();

        function updateHexValue(value) {
            document.getElementById('hexValue').value = value;
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Ø§ÙØ²ÙˆØ¯Ù† Ø±Ù†Ú¯';
            document.getElementById('colorForm').reset();
            document.getElementById('colorId').value = '';
            document.getElementById('hexValue').value = '#000000';
            document.getElementById('colorPicker').value = '#000000';
            openModal('colorModal');
        }

        async function loadColors() {
            const tableBody = document.getElementById('colorsTable');
            try {
                const response = await apiRequest('/api/color');

                if (!response || !response.data) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</td></tr>';
                    return;
                }

                if (response.data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Ù‡ÛŒÚ† Ø±Ù†Ú¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
                    return;
                }

                tableBody.innerHTML = '';
                response.data.forEach(color => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${color.id}</td>
                        <td>${color.title}</td>
                        <td>${color.hexValue}</td>
                        <td><div style="width: 40px; height: 25px; background: ${color.hexValue}; border-radius: 4px; border: 1px solid #ddd;"></div></td>
                        <td>
                            <button onclick="editColor(${color.id})" class="btn btn-sm btn-secondary">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button onclick="deleteColor(${color.id})" class="btn btn-sm btn-danger">Ø­Ø°Ù</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading colors:', error);
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§</td></tr>';
            }
        }

        async function editColor(id) {
            try {
                const response = await apiRequest(`/api/color/${id}`);
                if (response && response.data && response.data.length > 0) {
                    const color = response.data[0];
                    document.getElementById('modalTitle').textContent = 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø±Ù†Ú¯';
                    document.getElementById('colorId').value = color.id;
                    document.getElementById('title').value = color.title;
                    document.getElementById('hexValue').value = color.hexValue;
                    document.getElementById('colorPicker').value = color.hexValue;
                    openModal('colorModal');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±Ù†Ú¯', 'error');
            }
        }

        async function deleteColor(id) {
            if (!confirmAction('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø±Ù†Ú¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;

            try {
                const response = await apiRequest(`/api/admin/color/${id}`, { method: 'DELETE' });
                if (response && response.status === 'OK') {
                    showNotification('Ø±Ù†Ú¯ Ø­Ø°Ù Ø´Ø¯', 'success');
                    loadColors();
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù', 'error');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù', 'error');
            }
        }

        document.getElementById('colorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            setLoading(submitBtn, true);

            const id = document.getElementById('colorId').value;
            const data = {
                title: document.getElementById('title').value,
                hexValue: document.getElementById('hexValue').value
            };

            try {
                let response;
                if (id) {
                    response = await apiRequest(`/api/admin/color/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify(data)
                    });
                } else {
                    response = await apiRequest('/api/admin/color', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                }

                if (response && (response.status === 'OK' || response.status === 'CREATED')) {
                    showNotification('Ø±Ù†Ú¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                    closeModal('colorModal');
                    loadColors();
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡', 'error');
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡', 'error');
            } finally {
                setLoading(submitBtn, false);
            }
        });

        loadColors();
    </script>
</body>

</html>